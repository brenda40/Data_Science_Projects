---
title: "Problem Set 6"
author: "cdurso"
date: '`r format(Sys.time(),"%B %d, %Y")`'
output:
  pdf_document: default
  html_document:
    df_print: paged
---

These questions were rendered in R markdown through RStudio (<https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf>, <http://rmarkdown.rstudio.com> ).
```{r}

#Brenda Woodard, worked with Vivan Phinney

```

Please complete the following tasks, in R where applicable. Please generate a solution document in R markdown and upload the rendered .doc, .docx, or .pdf document.  You may add hand computatios to a .doc or .docx if you prefer. In the rendered document, please show your code.That is, don't use "echo=FALSE".  

In either case, your work should be based  on the data's being in the same folder as the R files. Please turn in your work on Canvas. Your solution document should have your answers to the questions and should display the requested plots.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(HistData)

```
  
  1. (Robustness of Welch's test) The following code illustrates several members of the parametrized family of Gamma distributions. 
  
```{r, cache=TRUE}
theor<-data.frame(x=seq(0,20,by=.1))
ggplot(data=theor, aes(x=x))+stat_function(fun=dgamma,args=list(shape=2,scale=2))+
  stat_function(fun=dgamma,args=list(shape=7,scale=1) , color="orange")+
  stat_function(fun=dgamma,args=list(shape=4,scale=1) , color="green")+
  stat_function(fun=dgamma,args=list(shape=1,scale=2) , color="purple")
```

  * 1.a. The function below generates two Normal samples of size 10, applies Welch's test, and reports the results. The vector "samp.norm" has 10,000 p-values generated by this process. Please use "samp.norm" to examine how well the approximate test performed. A plot of the quantiles of samp.norm against the theoretical quantiles for the uniform distribution on [0,1] is provided. How is it related to this question? Also, what is the meaning the proportion of p-values less than or equal to 0.05 for these distributions?  (4 points)

```{r, cache=TRUE,warning=FALSE}
normal.p<-function(){
  x<-rnorm(10)
  y<-rnorm(10,sd=2)
  t.test(x,y)$p.value
}


set.seed(56789)
samp.norm<-replicate(10000,normal.p())
mean(samp.norm<.05)

dat.norm<-data.frame(samp=samp.norm)

ggplot(data=dat.norm)+stat_qq(aes(sample=samp),distribution=stats::qunif)+
  geom_abline(slope=1,intercept=0,color="orange")

ggplot(data=dat.norm)+stat_qq(aes(sample=samp),distribution=stats::qunif)+xlim(0,.1)+ylim(0,.1)+
  geom_abline(slope=1,intercept=0,color="orange")


# The test performed great. 
# The plot shows that the quantiles of samp.norm match the theoretical quantiles.  
# The theoretical quantiles are plotted against a standard uniform distribution, so 
# the samp.norm vector matching the theoretical plot suggests that the vector is also
# a uniform distribution.
# The meaning of the proportion of p-values less than or equal to 0.05 represents 
# the likelihood of getting results from that portion of the data. 

```

  * 1.b. The function below generates two samples of size 10 from two members of the family of Gamma distributions, applies Welch's test, and reports the results. The vector "samp.2.4" has 10,000 p-values generated by this process. Please use "samp.2.4" to examine how well the approximate test performed under this violation of the hypotheses. Note both sampled distributions have the same mean=(shape)(scale). (4 points)

```{r, cache=TRUE,}
gamma.p.2.4<-function(){
  x<-rgamma(10,shape=2,scale=2)
  y<-rgamma(10,shape=4,scale=1)
  t.test(x,y)$p.value
}

set.seed(56789)
samp.2.4<-replicate(10000,gamma.p.2.4())


m_2<-mean(samp.2.4<0.05)
m_2

dat.norm_2<-data.frame(samp=samp.2.4)

ggplot(data=dat.norm_2)+stat_qq(aes(sample=samp),distribution=stats::qunif)+
  geom_abline(slope=1,intercept=0,color="orange")


# See d for comments
```

  * 1.c. The function below generates two samples of size 10 from a member of the family of Gamma distributions, applies Welch's test, and reports the results. The vector "samp.7.1" has 10,000 p-values generated by this process. Please use "samp.7.1" to examine how well the approximate test performed under this violation of the hypotheses. (4 points)

```{r, cache=TRUE}
gamma.p.7.1<-function(){
  x<-rgamma(10,shape=7,scale=1)
  y<-rgamma(10,shape=7,scale=1)
  t.test(x,y)$p.value
}

set.seed(56789)
samp.7.1<-replicate(10000,gamma.p.7.1())

m_3<-mean(samp.7.1<0.05)
m_3

dat.norm_3<-data.frame(samp=samp.7.1)

ggplot(data=dat.norm_3)+stat_qq(aes(sample=samp),distribution=stats::qunif)+
  geom_abline(slope=1,intercept=0,color="orange")

# See d for comments
```

  * 1.d. The function below generates two samples of size 10 from a member of the family of Gamma distributions, applies Welch's test, and reports the results. The vector "samp.1.2" has 10,000 p-values generated by this process. Please use "samp.1.2" to examine how well the approximate test performed under this violation of the hypotheses.(3 points) 


```{r, cache=TRUE}
gamma.p.1.2<-function(){
  x<-rgamma(10,shape=1,scale=2)
  y<-rgamma(10,shape=1,scale=2)
  t.test(x,y)$p.value
}

set.seed(56789)
samp.1.2<-replicate(10000,gamma.p.1.2())


m_4<-mean(samp.1.2<0.05)
m_4

dat.norm_4<-data.frame(samp=samp.1.2)

ggplot(data=dat.norm_4)+stat_qq(aes(sample=samp),distribution=stats::qunif)+
  geom_abline(slope=1,intercept=0,color="orange")


# For #1 a,b,& c  the p-values are all around 0.05, which is great.
# On part d we finally get the p-value to approximately 0.03 which
# shows that the farther the shape gets away from the value of the 
# scale the less accurate our results get from the uniform distribution. 

```




  2. Returning to the data from "precipitation_boulder.csv", the file "precipitation.RData" contains the data.frame dat.trim created from the code in ps5, followed by the command 

save(dat.trim,file="precipitation.RData")

The command

load("precipitation.RData")

imports dat.trim directly into the current environment.

The period 1930-1940 in the Midwest was characterized by drought and dust storms. In this problem, you will examine whether precipitation in Boulder was also unusually low during this period, compared to the preceding period 1910-1920.

  * 2.a. Are the annual precipitation totals in 1930-1940 approximately Normally distributed? Are the annual precipitation totals in 1910-1920 approximately Normally distributed? Please provide visual support for your conclusions. (5 points)
  
```{r, warning=FALSE}

load("precipitation.RData")
ggplot(data=filter(dat.trim,year>=1910 & year<=1940),
       aes(x=year,y=total))+geom_line()+geom_point()


keep.cols <- c('year','total')
t_1<- dat.trim[37:47, names(dat.trim) %in% keep.cols]



keep.cols <- c('year','total')
t_2<- dat.trim[17:27, names(dat.trim) %in% keep.cols]


ggqqplot(t_1$total)
ggqqplot(t_2$total)

# They are normally distributed. 

```

 
  * 2.b. Perform Welch's t test to test the hypothesis that the annual precipitation totals in 1930-1940 and the annual precipitation totals in 1910-1920 are drawn from populations with equal means. Does the result provide evidence for unusually low rainfall in the 1930-1940 time period? Please comment on the applicability of the test, based on your observations in 2.a. (5 points)
  
```{r}

t.test(t_1$total, t_2$total)
 
# They are not drawn from populations with equal means. 

# The result does provide evidence for unusually low rainfall. 

# This test is applicable to our data because we have normal distributions. 
```



  * 2.c. Are the variances of the annual precipitation totals in 1930-1940 and the annual precipitation totals in 1910-1920 approximately equal? (5 points)
  
```{r}

var.test (t_1$total, t_2$total)

# No they are not even close to equal.
```


  * 2.d. Please plot the densities of the total precipitation in 1930-1940 and 1910-1920. (5 points)

```{r}
d_1<- density(t_1$total)
d_2<- density(t_2$total)

plot(d_1, type= "l", main="Densities of Total Precipitation", ylim= c(0,0.15), xlim= c(5,35), xlab= "precipitation", col = "red")+
  lines(d_2, type = "l", col = "blue")
  
```

  * 2.e. Please compare the total precipitation in the years 1930-1940 and 1910-1920 using the Mann-Whitney U-test, aka Wilcoxon rank sum test. Please interpret the results. (5 points)
  
```{r}

wilcox.test(t_1$total,t_2$total,
            paired=FALSE)

# The test proves the null hypothesis.

```
  

  3. Application of the F statistic to data of unknown means depends on the claim the if
$X_1, X_2, ...X_n$ and $Y_1, Y_2, ...Y_{n-1}$ are independent identically distributed samples from a Normal distribution with mean equal to $\mu$ then $\frac{\sum_{j=1}^{n}\left(X_{i}-\bar{X}\right)^{2}}{n-1}$ has the same distribution as $\frac{\sum_{j=1}^{n-1}\left(Y_{i}-\mu\right)^{2}}{n-1}$. Here $\bar{X}=\frac{\sum_{j=1}^{n} X_i}{n}$. (10 points)
 
 Create a visualization to compare the density function of data created by sampling 100,000 times from the distributions of $\frac{\sum_{j=1}^{n}\left(X_{i}-\bar{X}\right)^{2}}{n-1}$ and $\frac{\sum_{j=1}^{n-1}\left(Y_{i}-\mu\right)^{2}}{n-1}$. The geom_density() option in ggplot2 may come in handy.  (10 points)

```{r, cache=TRUE}

n=6

x<-function(n){
  rn<-rnorm(n)
  x_d<- (sum((rn-mean(rn))^2))/(n-1)
  return (x_d)
}


y<-function(n){
  rn_2<-rnorm(n-1)
  y_d<-(sum((rn_2-0)^2))/(n-1)  
  return(y_d)
}


set.seed(56789)

r_1<- replicate(100000,x(n))
r_2<-replicate(100000,y(n))


d_f<- data.frame(r_1)
d_f_2<- data.frame(r_2)


 ggplot() +
    geom_density(data=d_f, aes(r_1),color="darkblue", fill="lightblue", alpha=0.4)+
    geom_density(data=d_f_2, aes(r_2), color="red", fill="pink", alpha=0.4)


# They're distributions are the same. 
```



  
 





